
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Installation &#8212; ComNetsEmu v0.3.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="FAQ" href="faq.html" />
    <link rel="prev" title="comnetsemu.util module" href="api/comnetsemu.util.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">ComNetsEmu</a></h1>



<p class="blurb">A virtual emulator/testbed designed for the book: Computing in Communication Networks: From Theory to Practice</p>






<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="api/modules.html">Python API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#option-1-install-in-a-vagrant-managed-vm-highly-recommended">Option 1: Install in a Vagrant managed VM (Highly Recommended)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#option-2-install-on-user-s-custom-vm-or-directly-on-host-os">Option 2: Install on user’s custom VM or directly on host OS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#option-3-download-the-pre-built-vm-image">Option 3: Download the pre-built VM image</a></li>
<li class="toctree-l2"><a class="reference internal" href="#post-installation">Post-Installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref_links.html">Reference Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">Roadmap of ComNetsEmu</a></li>
<li class="toctree-l1"><a class="reference internal" href="vm_setup_issues.html">Known VM Setup Issues</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="api/comnetsemu.util.html" title="previous chapter">comnetsemu.util module</a></li>
      <li>Next: <a href="faq.html" title="next chapter">FAQ</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="tex2jax_ignore mathjax_ignore section" id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="option-1-install-in-a-vagrant-managed-vm-highly-recommended">
<h2>Option 1: Install in a Vagrant managed VM (Highly Recommended)<a class="headerlink" href="#option-1-install-in-a-vagrant-managed-vm-highly-recommended" title="Permalink to this headline">¶</a></h2>
<p>The comfortable way to setup the test and development environment is to run a
pre-configured VM managed by <a class="reference external" href="https://www.vagrantup.com/">Vagrant</a>.
Vagrant supports multiple providers including Virtualbox and <a class="reference external" href="https://libvirt.org/">Libvirt</a> (With <a class="reference external" href="https://github.com/vagrant-libvirt/vagrant-libvirt">vagrant-libvirt plugin</a>).
Most examples and applications included in this repository can run on
Virtualbox which is cross-platform. Therefore, you host OS can be any OS that
supports Virtualbox (GNU/Linux, Windows and Mac OS etc.).</p>
<p>Mainly due to the performance and special feature requirements, some examples
and applications can run <strong>only</strong> on VM with
<a class="reference external" href="https://en.wikipedia.org/wiki/Kernel-based_Virtual_Machine">KVM</a> as the
hypervisor:</p>
<ol class="arabic simple">
<li><p>machine_learning_for_routing</p></li>
<li><p>machine_learning_for_congestion_control</p></li>
</ol>
<p>In order to run these programs, your host OS must use <a class="reference external" href="https://en.wikipedia.org/wiki/Linux_kernel">Linux kernel</a>.
You can install a GNU/Linux distribution on your physical machine.
WARN: Two providers can not be used at the same time.
Same VM can be created either by Virtualbox or KVM.</p>
<p>Recommended and tested setup:</p>
<ul class="simple">
<li><p>Vagrant: &gt;= v2.2.5 (<a class="reference external" href="https://www.vagrantup.com/downloads.html">Download Link</a>)</p></li>
<li><p>Virtualbox: &gt;= v6.0 (<a class="reference external" href="https://www.virtualbox.org/wiki/Downloads">Download Link</a>)</p></li>
<li><p>(Optional) Libvirt: &gt;= v6.0 (<a class="reference external" href="https://libvirt.org/downloads.html">Download Link</a>)</p></li>
<li><p>(Optional) Vagrant Libvirt Provider: &gt;= v0.7.0 (<a class="reference external" href="https://github.com/vagrant-libvirt/vagrant-libvirt#installation">Download Link</a>)</p></li>
</ul>
<p>A customized Vagrantfile is provided in this repository to manage the VM.
Both Virtualbox and Libvirt can be used to create the VM.
The default provider is Virtualbox.
Different providers uses different base boxes, please check the Vagrantfile for details.
You can choose the provider with <code class="docutils literal notranslate"><span class="pre">--provider</span></code> option of the <code class="docutils literal notranslate"><span class="pre">vagrant</span> <span class="pre">up</span></code> command.</p>
<ul class="simple">
<li><p>Some Known Issues</p></li>
</ul>
<p>Please follow the documentation to setup the VM with proper resource allocation.
If the <code class="docutils literal notranslate"><span class="pre">vagrant</span> <span class="pre">up</span></code> command fails to setup the VM fully correct which you can
test by running the basic <em>Docker-in-Docker</em> example.
Please firstly check the <a class="reference internal" href="vm_setup_issues.html"><span class="doc std std-doc">known VM setup issues</span></a> for potential solutions.</p>
<ul class="simple">
<li><p>VM Resource Allocation (<strong>Important</strong>)</p></li>
</ul>
<p>By default, this VM is allocated with <strong>2</strong> vCPUs and <strong>4GB</strong> RAM to run all
examples and applications smoothly.
If you machine does not have enough resources, you need to change the variable
<em>CPUS</em> and <em>RAM</em> in the Vagrantfile <strong>before</strong> created the VM.</p>
<ul class="simple">
<li><p>Use Virtualbox as Provider</p></li>
</ul>
<p>To manage the Virtualbox VM, please open a terminal on your host OS and change
the working directory to the directory containing the ComNetsEmu’s source code.
Use following commands to manage the VM.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># This will create the VM at the first time (takes around 20 minutes)</span>
$ vagrant up comnetsemu

<span class="c1"># SSH into the VM</span>
$ vagrant ssh comnetsemu

<span class="c1"># Power off the VM</span>
$ vagrant halt comnetsemu

<span class="c1"># Remove/Delete the VM</span>
$ vagrant destroy comnetsemu
</pre></div>
</div>
<ul class="simple">
<li><p>Use Libvirt as Provider</p></li>
</ul>
<p>To create the VM with Libvirt provider, check the <a class="reference external" href="https://github.com/vagrant-libvirt/vagrant-libvirt#installation">guide</a> to install the plugin.</p>
<p>After successful installation, run the following command in the ComNetsEmu’s source directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ vagrant up --provider libvirt comnetsemu
<span class="c1"># Remove the VM managed by libvirt, the default provider is Virtualbox. </span>
<span class="c1"># Use VAGRANT_DEFAULT_PROVIDER to force vagrant to use libvirt.</span>
$ <span class="nv">VAGRANT_DEFAULT_PROVIDER</span><span class="o">=</span>libvirt vagrant destroy comnetsemu
</pre></div>
</div>
<ul class="simple">
<li><p>Customization Shell Script</p></li>
</ul>
<p>A customization shell script (should be located in <code class="docutils literal notranslate"><span class="pre">./util/vm_customize.sh</span></code>) is executed at the end of the provision process.
The script is executed by the <code class="docutils literal notranslate"><span class="pre">vagrant</span></code> user, who can run the sudo command without a password.
This script can be used to add your customization to the ComNetsEmu VM.</p>
<p>Example of <code class="docutils literal notranslate"><span class="pre">vm_customize.sh</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt install -y zsh
<span class="c1"># Install oh-my-zsh framework</span>
sh -c <span class="s2">&quot;</span><span class="k">$(</span>wget -O- https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh<span class="k">)</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>As configured in <code class="docutils literal notranslate"><span class="pre">./Vagrantfile</span></code>, source code folder on the host OS is synced to the <code class="docutils literal notranslate"><span class="pre">/home/vagrant/comnetsemu</span></code> folder in the VM.
So you can work on emulators or application code in your host OS and run/test them in the VM.</p>
<p>Warning: Installation with option 1 is already finished here.
You can SSH into the VM to run examples and applications.
The option 2 is <strong>only</strong> for users who want to install it on their own customized VM or bare metal.</p>
</div>
<div class="section" id="option-2-install-on-user-s-custom-vm-or-directly-on-host-os">
<h2>Option 2: Install on user’s custom VM or directly on host OS<a class="headerlink" href="#option-2-install-on-user-s-custom-vm-or-directly-on-host-os" title="Permalink to this headline">¶</a></h2>
<p>As described above, installation on user’s custom VM or directly on the host OS has several disadvantages.
It is not convenient to manage the test environment compared to the option 1.
For this option, it is recommended to install Ubuntu <strong>20.04 LTS</strong> <strong>freshly</strong>
inside the VM or as the host OS to avoid potential package conflicts.
Currently, this option is not well-tested compared to the option 1.</p>
<ul class="simple">
<li><p>Install essential packages required by the installer from your package management systems:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt update
$ sudo apt upgrade
$ sudo apt install git iperf iperf3 make pkg-config python3 python3-dev python3-pip sudo
</pre></div>
</div>
<ul class="simple">
<li><p>Install ComNetsEmu with all dependencies:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="nv">$TOP_DIR</span>/comnetsemu/util
$ bash ./install.sh -a
</pre></div>
</div>
</div>
<div class="section" id="option-3-download-the-pre-built-vm-image">
<h2>Option 3: Download the pre-built VM image<a class="headerlink" href="#option-3-download-the-pre-built-vm-image" title="Permalink to this headline">¶</a></h2>
<p>Only if the previous option does not suit you, please use this option.
Because the VM image may not be updated frequently and you need to manually
configure the VM for e.g. port forwarding, folder synchronization.</p>
<p>The VM image (comnetsemu.ova) for Virtualbox is uploaded to the <a class="reference external" href="https://drive.google.com/drive/folders/1FP5Bx2DHp7oV57Ja38_x01ABiw3wK11M?usp=sharing">Google cloud
drive</a>.
Please verify the sha512sum with the given files in the folder.</p>
<p>The default account and password for the VM are both <code class="docutils literal notranslate"><span class="pre">vagrant</span></code>.
There is no pre-configured root password.
The <code class="docutils literal notranslate"><span class="pre">vagrant</span></code> user can run <code class="docutils literal notranslate"><span class="pre">sudo</span></code> command without password, so root password
can be configured via <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">passwd</span></code> if required.</p>
<p>For KVM user, you can convert the ova file to qcow2 file with following
commands (Assume the file has the name some_name):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ tar -xvf some_name.ova
$ qemu-img convert some_name.vmdk some_name.qcow2 -O qcow2
</pre></div>
</div>
</div>
<div class="section" id="post-installation">
<h2>Post-Installation<a class="headerlink" href="#post-installation" title="Permalink to this headline">¶</a></h2>
<p><strong>MARK</strong>: ComNetsEmu is developed with Python3 (3.8).
Please use <code class="docutils literal notranslate"><span class="pre">python3</span></code> command to run examples or applications.
Because the current master branch is still under heavy development, therefore
this <code class="docutils literal notranslate"><span class="pre">python3</span></code> package can be only installed from source using setuptools.</p>
<p>ComNetsEmu uses Docker containers to emulate network nodes.
Some images are used to run hosts and app containers in examples and also applications.
The Dockerfiles for external Docker hosts are located in <code class="docutils literal notranslate"><span class="pre">./test_containers</span></code>.</p>
<p>These Docker images are built automatically when the Vagrant VM is created.
The upgrade script of ComNetsEmu also rebuild them automatically.</p>
<p>If there is an error related to the test Docker images, they can be created also manually:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ./test_containers
<span class="c1"># This script also removes all dangling images after build.</span>
$ python ./build.py
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2022 The Deutsche Telekom Chair of Communication Networks.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/installation.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>